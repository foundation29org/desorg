<div class="row">
    <div  class="form-group" *ngIf="!loadedUsers">
        <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
      </div>
	<div class="col-lg-12 col-12" *ngIf="loadedUsers">
		<div class="card">
			<div class="card-header">
				<h4 class="card-title">{{'do.community' | translate }}</h4>
			</div>
			<div class="card-body table-responsive">
				<table class="table">
					<thead>
						<tr>
							<th>Id</th>
							<th>Name</th>
							<th>Info</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let patient of patients ; let i = index">
							<td>
								<span *ngIf="patient.result.entry[0].resource.gender=='female'" class="fa fa-2x fa-female grey mr-2"></span>
								<span *ngIf="patient.result.entry[0].resource.gender=='male'" class="fa fa-2x fa-male grey mr-2"></span>
								<span *ngIf="patient.result.entry[0].resource.gender!='male' && patient.result.entry[0].resource.gender!='female'" class="fa fa-2x fa-question grey mr-2"></span>
								{{patient.patientId}}
							</td>
							<td>{{patient.result.entry[0].resource.name.given[0]}}</td>
							<td>
								<span *ngIf="patient.result.entry[0].resource.age!=null">
									<span *ngIf="patient.result.entry[0].resource.age.years>0">{{patient.result.entry[0].resource.age.years}} {{'topnavbar.year' | translate }}<span *ngIf="patient.result.entry[0].resource.age.years>1">s</span> <span *ngIf="patient.result.entry[0].resource.age.months>0">, </span></span>
									<span *ngIf="patient.result.entry[0].resource.age.months>0">{{patient.result.entry[0].resource.age.months}} <span *ngIf="patient.result.entry[0].resource.age.months<=1">{{'topnavbar.month' | translate }}</span><span *ngIf="patient.result.entry[0].resource.age.months>1">{{'topnavbar.months' | translate }}</span></span>
									<span *ngIf="patient.result.entry[0].resource.age.months==0 && patient.result.entry[0].resource.age.years==0">0 {{'topnavbar.months' | translate }}</span>
								</span>
								<span *ngIf="patient.result.entry[0].resource.age==null">-</span>
							</td>
							<td>
								<span class="mt-1 nav-item" ngbDropdown display="dynamic" placement="bottom-right">
									<a class="position-relative colorlink" style="padding: 0rem 1rem;" id="dropdownPat{{i}}"
									  ngbDropdownToggle title="{{'generics.Options' | translate }}">
									  <i class="mt-1 fas fa-ellipsis-v font-medium-3 secondary"></i>
									</a>
									<div ngbDropdownMenu aria-labelledby="dropdownPat{{i}}" class="dropdown">
									  <a class="dropdown-item py-1" href="javascript:;" (click)="viewPatient(patient.patientId, contentModalPatient)">
										<span class="">{{'generics.View' | translate }}</span>
									  </a>
									  <a class="dropdown-item py-1" href="javascript:;" [disabled]="loading" (click)="download(patient.patientId)">
										<span class="">{{'generics.Download' | translate }}</span>
									  </a>
									  <div *ngIf="loading" class="center-elements">
									  	<i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i>
									  </div>
									</div>
								  </span>
							</td>
						</tr>
					</tbody>
				</table>
				<div class="d-none"><span id="content"></span></div>
			</div>
		</div>
	</div>
</div>

<ng-template #contentModalPatient let-c="close" let-d="dismiss" appendTo="body">
	<div class="modal-header d-block" id="idHeader">
	  <button type="button" class="close" aria-label="Close" (click)="closeModal()">
		<span aria-hidden="true">&times;</span>
	  </button>
	  <div>
		<h4 class="mb-0">
			Patient
			<span class="font-small-3 mute d-block">{{actualPatient.resume.resource.id}}</span>
		</h4>
	  </div>
	</div>
	  <div class="content-wrapper">
		<div class="row col-md-12">
		  <div class="col-md-12">
			<section>
			  <div class="mt-2">
				<div>
				 <div class="bg-white mt-4 mb-4">
					<a id="initcrono"></a>
					<mat-accordion class="d-block d-xl-none text-left">
					  <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
						<mat-expansion-panel-header>
						  <mat-panel-title>
							Resumen
						  </mat-panel-title>
						</mat-expansion-panel-header>
						<div class="p-3 m-3 border rounded" style="background-color: #A1CBEA !important;">
						  <p class="ml-2 mr-2">{{actualPatient.resume.resource|json}}</p>
						  <p class="ml-2 mr-2">{{actualPatient.condition.resource|json}}</p>
						</div>
						<div class="card-body">
						</div>
					  </mat-expansion-panel>
					  <mat-expansion-panel [expanded]="step === 2" *ngIf="actualPatient.seizures" (opened)="setStep(2)">
						<mat-expansion-panel-header>
							<mat-panel-title >
								{{'do.seizures' | translate }}
							</mat-panel-title>
						  </mat-expansion-panel-header>
						  <div class="card-body">
							<div class="card-body table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Name</th>
											<th>Duration</th>
											<th>Date</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let element of actualPatient.seizures ; let i = index">
											<td>{{element.resource.code.text}}</td>
											<td>{{element.resource.valueQuantity.value}}</td>
											<td>{{element.resource.effectiveDateTime |date}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						  </div>
					  </mat-expansion-panel>
					  <mat-expansion-panel [expanded]="step === 3" *ngIf="actualPatient.drugs" (opened)="setStep(3)">
						<mat-expansion-panel-header>
						  <mat-panel-title >
							{{'do.drugs' | translate }}
						  </mat-panel-title>
						</mat-expansion-panel-header>
						<div class="card-body">
							<div class="card-body table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Name</th>
											<th>Dose</th>
											<th>Start</th>
											<th>End</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let element of actualPatient.drugs ; let i = index">
											<td>{{element.resource.contained[0].code.coding[0].display}}</td>
											<td>{{element.resource.dosage[0].doseAndRate[0].doseQuantity.value}} mg/day</td>
											<td>{{element.resource.effectivePeriod.start |date}}</td>
											<td *ngIf="element.resource.effectivePeriod.end!=null">{{element.resource.effectivePeriod.end |date}}</td>
											<td *ngIf="element.resource.effectivePeriod.end==null">Is taken</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					  </mat-expansion-panel>
					  <mat-expansion-panel [expanded]="step === 4" *ngIf="actualPatient.feels" (opened)="setStep(4)">
						<mat-expansion-panel-header>
							<mat-panel-title >
								{{'do.quality' | translate }}
							</mat-panel-title>
						  </mat-expansion-panel-header>
						  <div class="card-body">
							<div class="card-body table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Value</th>
											<th>Date</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let element of actualPatient.feels ; let i = index">
											<td>{{element.resource.valueQuantity.value}}</td>
											<td>{{element.resource.effectiveDateTime |date}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						  </div>
					  </mat-expansion-panel>
					  <mat-expansion-panel [expanded]="step === 5" *ngIf="actualPatient.phenotypes" (opened)="setStep(5)">
						<mat-expansion-panel-header>
							<mat-panel-title >
								{{'do.symptoms' | translate }}
							</mat-panel-title>
						  </mat-expansion-panel-header>
						  <div class="card-body">
							<div class="card-body table-responsive">
								<table class="table text-center">
									<thead>
										<tr>
											<th>Value</th>
											<th>Date</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let element of actualPatient.phenotypes ; let i = index">
											<td>{{element.resource.valueString}}</td>
											<td>{{element.resource.effectiveDateTime |date}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						  </div>
					  </mat-expansion-panel>
					  <mat-expansion-panel [expanded]="step === 6" *ngIf="actualPatient.questionnaires" (opened)="setStep(6)">
						<mat-expansion-panel-header>
							<mat-panel-title >
								{{'do.questionnaires' | translate }}
							</mat-panel-title>
						  </mat-expansion-panel-header>
						  <div class="card-body">
							<div class="card-body table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Questionaire</th>
											<th>Info</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let element of actualPatient.questionnaires ; let i = index">
											<td>{{element.resource.id}}</td>
											<td>
												<p *ngFor="let item of element.resource.item ; let j = index">
													{{item.answer[0].valueString}}
												</p>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						  </div>
					  </mat-expansion-panel>
					</mat-accordion>
					<ngb-tabset type="pills" id="tabspills" #tabRef="ngbTabset" class="d-none col-xl-12 d-xl-block text-left">
					  <ngb-tab id="tab0">
						<ng-template ngbTabTitle><strong>Resumen</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="p-3 m-3 border rounded text-center" style="background-color: #A1CBEA !important;">
							<p class="ml-2 mr-2">{{actualPatient.resume.resource|json}}</p>
							<p class="ml-2 mr-2">{{actualPatient.condition.resource|json}}</p>
						  </div>
						  <div class="col-md-12 pb-2">
							<div class="row">
							  <div class="col-md-12 mt-1">
								<div class="col-md-12">
									
								</div>
							  </div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					  <ngb-tab id="tab1" *ngIf="actualPatient.seizures">
						<ng-template ngbTabTitle><strong>{{'do.seizures' | translate }}</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="col-md-12 mb-3 pb-2">
							<div class="row">
							  <div class="col-md-12 mt-2">
								<div>
								  <div class="row">
									<div class="col-md-12 align-items-center">
										<div class="card-body table-responsive">
											<table class="table">
												<thead>
													<tr>
														<th>Name</th>
														<th>Duration</th>
														<th>Date</th>
													</tr>
												</thead>
												<tbody>
													<tr *ngFor="let element of actualPatient.seizures ; let i = index">
														<td>{{element.resource.code.text}}</td>
														<td>{{element.resource.valueQuantity.value}}</td>
														<td>{{element.resource.effectiveDateTime |date}}</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								  </div>
								</div>
							  </div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					  <ngb-tab id="tab2" *ngIf="actualPatient.drugs">
						<ng-template ngbTabTitle><strong>
							{{'do.drugs' | translate }}</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="pb-2">
							<div class="col-md-12">
								<div class="card-body table-responsive">
									<table class="table">
										<thead>
											<tr>
												<th>Name</th>
												<th>Dose</th>
												<th>Start</th>
												<th>End</th>
											</tr>
										</thead>
										<tbody>
											<tr *ngFor="let element of actualPatient.drugs ; let i = index">
												<td>{{element.resource.contained[0].code.coding[0].display}}</td>
												<td>{{element.resource.dosage[0].doseAndRate[0].doseQuantity.value}} mg/day</td>
												<td>{{element.resource.effectivePeriod.start |date}}</td>
												<td *ngIf="element.resource.effectivePeriod.end!=null">{{element.resource.effectivePeriod.end |date}}</td>
												<td *ngIf="element.resource.effectivePeriod.end==null">Is taken</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					  <ngb-tab id="tab3" *ngIf="actualPatient.feels">
						<ng-template ngbTabTitle><strong>
							{{'do.quality' | translate }}</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="pb-2">
							<div class="col-md-12">
								<div class="card-body table-responsive">
									<table class="table">
										<thead>
											<tr>
												<th>Value</th>
												<th>Date</th>
											</tr>
										</thead>
										<tbody>
											<tr *ngFor="let element of actualPatient.feels ; let i = index">
												<td>{{element.resource.valueQuantity.value}}</td>
												<td>{{element.resource.effectiveDateTime |date}}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					  <ngb-tab id="tab4" *ngIf="actualPatient.phenotypes">
						<ng-template ngbTabTitle><strong>
							{{'do.symptoms' | translate }}</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="pb-2">
							<div class="col-md-12">
								<div class="card-body table-responsive">
									<table class="table text-center">
										<thead>
											<tr>
												<th>Value</th>
												<th>Date</th>
											</tr>
										</thead>
										<tbody>
											<tr *ngFor="let element of actualPatient.phenotypes ; let i = index">
												<td>{{element.resource.valueString}}</td>
												<td>{{element.resource.effectiveDateTime |date}}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					  <ngb-tab id="tab5" *ngIf="actualPatient.questionnaires">
						<ng-template ngbTabTitle><strong>
							{{'do.questionnaires' | translate }}</strong></ng-template>
						<ng-template ngbTabContent>
						  <div class="pb-2">
							<div class="col-md-12">
								<div class="card-body table-responsive">
									<table class="table">
										<thead>
											<tr>
												<th>Questionaire</th>
												<th>Info</th>
											</tr>
										</thead>
										<tbody>
											<tr *ngFor="let element of actualPatient.questionnaires ; let i = index">
												<td>{{element.resource.id}}</td>
												<td>
													<p *ngFor="let item of element.resource.item ; let j = index">
														{{item.answer[0].valueString}}
													</p>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						  </div>
						</ng-template>
					  </ngb-tab>
					</ngb-tabset>
					<div class="mt-2" *ngIf="showButtonScroll">
					  <button type="button" class="float-right btn btn-info round" (click)="goTopTabs()"><i class="ft-arrow-up fa-2x"></i></button>
					</div>
				  </div>
				</div>
			  </div>
			</section>
		  </div>
		</div>
	</div>
	<!--<div class="modal-footer">
	  <div class="col-md-12 center-elements">
		<div class="form-actions center">
		  <button *ngIf="maxStep>='5.0'" type="button" class="mt-2 mr-3 btn secondary btn-outline-secondary" (click)="cancelAnalysis()"><span style="margin-right: 10px;"></span> {{'generics.Cancel' | translate }}</button>
		  <button *ngIf="maxStep<'5.0'" type="button" class="mt-2 mr-3 btn secondary btn-outline-secondary" (click)="goPrevStep()"><span style="margin-right: 10px;"></span> {{'generics.Cancel' | translate }}</button>
		</div>
	  </div>
	</div>-->
  
  </ng-template>